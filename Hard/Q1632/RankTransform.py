from typing import List
import collections


# IMPORTANT QUESTION !!!

class Solution:
    def matrixRankTransform(self, matrix: List[List[int]]) -> List[List[int]]:
        g = collections.defaultdict(list)
        m, n = len(matrix), len(matrix[0])
        f = lambda x, y: (x, x) if x > y else (y, y)
        for y in range(m):
            for x in range(n):
                g[matrix[y][x]].append([x, y])
        r = [0 for _ in range(n + m)]
        for v in sorted(g):
            c = [0 for _ in range(n + m)]
            for [x, y] in g[v]:
                r[x] += 1 * (1 - c[x])
                r[n + y] += 1 * (1 - c[n + y])
                r[x], r[n + y] = f(r[x], r[n + y])
                c[x], c[n + y] = 1, 1
            for [x, y] in g[v][::-1]:
                r[x], r[n + y] = f(r[x], r[n + y])
            for [x, y] in g[v]:
                r[x], r[n + y] = f(r[x], r[n + y])
            for [x, y] in g[v]:
                matrix[y][x] = r[x]
        return matrix


m1 = [[7, 3, 6], [1, 4, 5], [9, 8, 2]]
m2 = [[-37, -50, -3, 44], [-37, 46, 13, -32], [47, -42, -3, -40], [-17, -22, -39, 24]]

m3 = [[-2, -35, -32, -5, -30, 33, -12],
      [7, 2, -43, 4, -49, 14, 17],
      [4, 23, -6, -15, -24, -17, 6],
      [-47, 20, 39, -26, 9, -44, 39],
      [-50, -47, 44, 43, -22, 33, -36],
      [-13, 34, 49, 24, 23, -2, -35],
      [-40, 43, -22, -19, -4, 23, -18]]

a3 = [[10, 3, 4, 9, 5, 15, 8],
      [12, 4, 2, 10, 1, 13, 14],
      [11, 13, 9, 8, 6, 7, 12],
      [2, 10, 11, 4, 9, 3, 15],
      [1, 2, 17, 16, 7, 15, 3],
      [5, 14, 18, 11, 10, 8, 4],
      [3, 15, 5, 6, 8, 14, 7]]

m4 = [[25, 8, 31, 42, -39, 8, 31, -10, 33, -44, 7, -30, 9, 44, 15, 26],
      [-3, -48, -17, -18, 9, -12, -21, 10, 1, 44, -17, 14, -27, 48, -21, -6],
      [49, 28, 27, -18, -31, 4, -13, 34, 49, 48, 47, -18, 33, 40, 15, 38],
      [5, -28, -49, -38, 1, 32, -25, -50, 29, -32, 35, -46, -43, 48, -49, -6],
      [-27, -24, 23, -14, -47, -12, 7, 6, 25, -16, 47, -26, 13, -12, -33, -18],
      [45, -48, 3, -26, -23, -36, -17, 38, 17, 12, 15, 46, 37, 40, 47, 26],
      [-19, -24, -21, -2, -7, -48, 47, 30, 5, -8, 23, -46, 21, -32, -33, -26],
      [-27, 32, 27, -26, 21, -32, -49, -10, 5, 20, -29, 46, -43, -44, 39, 22],
      [-43, 48, 27, 26, -27, 12, -1, -10, -27, 12, -29, -34, 41, -28, -25, -30],
      [25, -36, 35, -26, 37, -20, 31, 14, -19, -40, -29, -2, -39, -28, 11, 46],
      [49, -32, -29, -6, -47, 32, -17, -18, -23, 24, 23, 22, -47, -44, 27, 14],
      [37, -44, -33, -18, -47, 24, -17, -46, -43, -32, 15, -46, -27, -8, -25, 46],
      [41, -40, 31, -30, 13, -24, -29, 22, -15, -16, 47, 2, -39, 4, -25, -42],
      [-3, 12, 7, 14, -7, 8, -37, -34, -7, -12, 39, -38, 1, 44, 27, -34],
      [-47, 4, 7, -2, -43, -32, 27, 2, -43, -8, -33, 14, 49, -48, -5, 30],
      [-15, 8, -33, -26, -23, -32, -25, 22, 13, -20, -9, 26, 29, 4, -1, 2]]

sol = Solution()
print(sol.matrixRankTransform(m4))
